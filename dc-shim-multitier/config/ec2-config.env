#!/bin/bash
# EC2 Deployment Configuration for DC Shim Services
# Copy this file and customize for your environment

# ==============================================================================
# DEPLOYMENT ENVIRONMENT
# ==============================================================================
export WORKSHOP_ENV=${WORKSHOP_ENV:-"ec2-test"}
export DEPLOYMENT_ENV="${WORKSHOP_ENV}-datacenter-b01"

# ==============================================================================
# SHOP DC SHIM SERVICE CONFIGURATION
# ==============================================================================
export SHOP_DC_SHIM_PORT=8070
export TPM=10  # Transactions Per Minute

# Transaction retention settings (memory optimization)
export TRANSACTION_RETENTION_MINUTES=30
export TRANSACTION_CLEANUP_INTERVAL_MS=1800000
export AUDIT_LOG_ENABLED=true

# ==============================================================================
# DATABASE CONFIGURATION (SQL Server on localhost)
# ==============================================================================
export DB_CONNECTION_STRING="jdbc:sqlserver://localhost:1433;databaseName=master;encrypt=false;trustServerCertificate=true"
export DB_USERNAME=sa
export DB_PASSWORD="ShopPass123!"

# SQL Server Configuration
export ACCEPT_EULA=Y
export MSSQL_SA_PASSWORD="ShopPass123!"
export MSSQL_PID=Developer

# ==============================================================================
# KUBERNETES CLUSTER SERVICE ENDPOINTS
# ==============================================================================
# Replace these with your actual K8s service endpoints
# Format: http://<node-ip>:<nodeport> or LoadBalancer external IP
export CHECKOUT_SERVICE_ADDR="<K8S_CLUSTER_IP>:8080"
export EMAIL_SERVICE_URL="http://<K8S_CLUSTER_IP>:8080"

# ==============================================================================
# OPENTELEMETRY CONFIGURATION
# ==============================================================================
# Option 1: Use K8s collector agent (requires network access)
export OTEL_EXPORTER_OTLP_ENDPOINT="http://<K8S_NODE_IP>:4318"
# Option 2: Install collector on EC2 instance
# export OTEL_EXPORTER_OTLP_ENDPOINT="http://localhost:4318"

export OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf
export OTEL_SERVICE_NAME=shop-dc-shim-service
export OTEL_RESOURCE_ATTRIBUTES="service.name=shop-dc-shim-service,deployment.environment=${DEPLOYMENT_ENV},service.version=2.1.3,deployment.environment.name=${DEPLOYMENT_ENV},service.namespace=shop-dc-shim"
export OTEL_JAVAAGENT_ENABLED=true
export OTEL_INSTRUMENTATION_SPLUNK_JDBC_ENABLED=true

# ==============================================================================
# APPDYNAMICS CONFIGURATION (Dual Instrumentation)
# ==============================================================================
export APPDYNAMICS_AGENT_ACCOUNT_ACCESS_KEY=${APPDYNAMICS_AGENT_ACCOUNT_ACCESS_KEY:-"replace-appd-token"}
export APPDYNAMICS_AGENT_ACCOUNT_NAME=${APPDYNAMICS_AGENT_ACCOUNT_NAME:-"se-lab"}
export APPDYNAMICS_CONTROLLER_HOST_NAME=${APPDYNAMICS_CONTROLLER_HOST_NAME:-"se-lab.saas.appdynamics.com"}
export APPDYNAMICS_JAVA_AGENT_REUSE_NODE_NAME_PREFIX="shop-dc-shim-node"
export APPDYNAMICS_AGENT_APPLICATION_NAME=shop-dc-shim-service
export APPDYNAMICS_AGENT_TIER_NAME=shop-dc-shim
export APPDYNAMICS_CONTROLLER_PORT=443
export APPDYNAMICS_CONTROLLER_SSL_ENABLED=true
export APPDYNAMICS_AGENT_NODE_NAME="reuse"
export APPDYNAMICS_JAVA_AGENT_REUSE_NODE_NAME="true"
export APPDYNAMICS_JAVAAGENT_ENABLED=true
export AGENT_DEPLOYMENT_MODE=dual

# ==============================================================================
# LOAD GENERATOR CONFIGURATION
# ==============================================================================
export LOAD_GENERATOR_URL="http://localhost:${SHOP_DC_SHIM_PORT}"
export LOAD_GENERATOR_TPM=${TPM}

# ==============================================================================
# AGENT PATHS (customize based on your installation)
# ==============================================================================
export APPDYNAMICS_AGENT_PATH="/opt/appdynamics/javaagent.jar"
export SPLUNK_OTEL_JAVA_AGENT_PATH="/opt/splunk-otel-javaagent.jar"
